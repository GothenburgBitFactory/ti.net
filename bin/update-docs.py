from base64 import b64decode
import sys
import ast
import re

# changed_filenames = [
#     "doc/man1/timew-annotate.1.adoc",
#     "doc/man1/timew-cancel.1.adoc"
# ]

# encoded_file_contents = [
#     "Ln5+IENoYW5nZSB0byB0aGlzIGZpbGUgdG8gdHJpZ2dlciB3b3JrZmxvdyB+fgo9IHRpbWV3LWFubm90YXRlKDEpCgo9PSBOQU1FCnRpbWV3LWFubm90YXRlIC0gYWRkIGFuIGFubm90YXRpb24gdG8gaW50ZXJ2YWxzCgo9PSBTWU5PUFNJUwpbdmVyc2VdCip0aW1ldyBhbm5vdGF0ZSogW188aWQ+XyoqLi4uKipdIF88YW5ub3RhdGlvbj5fCgo9PSBERVNDUklQVElPTgpUaGUgJ2Fubm90YXRlJyBjb21tYW5kIGlzIHVzZWQgdG8gYWRkIGFuIGFubm90YXRpb24gdG8gYW4gaW50ZXJ2YWwuCgpTZWUgdGhlICdzdW1tYXJ5JyBjb21tYW5kIG9uIGhvdyB0byBkaXNwbGF5IHRoZSBfPGlkPl8gYW5kIF88YW5ub3RhdGlvbj5fIG9mIGFuIGludGVydmFsLgoKPT0gRVhBTVBMRVMKKkFubm90YXRlIGEgc2luZ2xlIGludGVydmFsKjo6CisKQ2FsbCB0aGUgY29tbWFuZCB3aXRoIGFuIF9pZF8gYW5kIHRoZSBfYW5ub3RhdGlvbl86CisKW3NvdXJjZV0KLS0tLQokIHRpbWV3IGFubm90YXRlIEAyICdMb3JlbSBpcHN1bScKQW5ub3RhdGVkIEAyIHdpdGggIkxvcmVtIGlwc3VtIgotLS0tCgoqUmVtb3ZlIGFuIGFubm90YXRpb24qOjoKKwpBbm5vdGF0aW5nIGFuIGludGVydmFsIHdpdGggYW4gZW1wdHkgc3RyaW5nIHJlbW92ZXMgdGhlIGFubm90YXRpb246CisKW3NvdXJjZV0KLS0tLQokIHRpbWV3IGFubm90YXRlIEAxICcnClJlbW92ZWQgYW5ub3RhdGlvbiBmcm9tIEAxCi0tLS0KCipBbm5vdGF0ZSBtdWx0aXBsZSBpbnRlcnZhbHMqOjoKKwpZb3UgY2FuIGFubm90YXRlIG11bHRpcGxlIGludGVydmFscyB3aXRoIHRoZSBzYW1lIF9hbm5vdGF0aW9uXyBhdCBvbmNlLCBieSBzcGVjaWZ5aW5nIHRoZWlyIGlkczoKKwpbc291cmNlXQotLS0tCiQgdGltZXcgYW5ub3RhdGUgQDIgQDEwIEAyMyAnTG9yZW0gaXBzdW0nCkFubm90YXRlZCBAMSB3aXRoICJMb3JlbSBpcHN1bSIKQW5ub3RhdGVkIEAxMCB3aXRoICJMb3JlbSBpcHN1bSIKQW5ub3RhdGVkIEAyMyB3aXRoICJMb3JlbSBpcHN1bSIKLS0tLQoKKkFubm90YXRlIHRoZSBjdXJyZW50IG9wZW4gaW50ZXJ2YWwqOjoKKwpJZiB0aGVyZSBpcyBhY3RpdmUgdGltZSB0cmFja2luZywgeW91IGNhbiBvbWl0IHRoZSBJRCB3aGVuIHlvdSB3YW50IHRvIGFkZCBhbiBhbm5vdGF0aW9uIHRvIHRoZSBjdXJyZW50IG9wZW4gaW50ZXJ2YWw6CisKW3NvdXJjZV0KLS0tLQokIHRpbWV3IHN0YXJ0IGZvbwouLi4KJCB0aW1ldyBhbm5vdGF0ZSBiYXIKQW5ub3RhdGVkIEAxIHdpdGggImJhciIKLS0tLQorClRoaXMgcmVzdWx0cyBpbiB0aGUgY3VycmVudCBpbnRlcnZhbCBoYXZpbmcgdGFnICdmb28nIGFuZCBhbm5vdGF0aW9uICdiYXInLgoKPT0gcGFzczpbQlVHUyAmIExJTUlUQVRJT05TXQpUaGUgc3VtbWFyeSBjb21tYW5kIHRydW5jYXRlcyBhbm5vdGF0aW9ucyBsb25nZXIgdGhhbiAxNSBjaGFyYWN0ZXJzLgpUbyBkaXNwbGF5IGxvbmdlciBhbm5vdGF0aW9ucywgb25lIGNhbiB1c2UgdGhlICdleHBvcnQnIGNvbW1hbmQsIG9yIGEgY3VzdG9tIHJlcG9ydC4KCkN1cnJlbnRseSwgdGhlIGFubm90YXRpb24gY29tbWFuZCBwaWNrcyB0aGUgbGFzdCB0b2tlbiBmcm9tIHRoZSBjb21tYW5kIGxpbmUgYW5kIHVzZXMgaXQgYXMgYW5ub3RhdGlvbi4KSS5lLiB1c2luZyBubyBxdW90ZXMgaW4gYW4gYW5ub3RhdGlvbiBjb21tYW5kIGxpa2UKCltzb3VyY2VdCi0tLS0KJCB0aW1ldyBhbm5vdGF0ZSBAMSBsb3JlbSBpcHN1bQotLS0tCgp3aWxsIHJlc3VsdCBpbiBpbnRlcnZhbCBAMSBoYXZpbmcgb25seSAnaXBzdW0nIGFzIGl0cyBhbm5vdGF0aW9uLgpVc2UgcXVvdGVzIHRvIGF2b2lkIHRoaXMuCgo9PSBTRUUgQUxTTwoqKnRpbWV3LWV4cG9ydCoqKDEpLAoqKnRpbWV3LXN1bW1hcnkqKigxKSwKKip0aW1ldy10YWcqKigxKQo=",
#     "Ln5+IENoYW5nZSB0byB0aGlzIGZpbGUgdG8gdHJpZ2dlciB3b3JrZmxvdyB+fgo9IHRpbWV3LWNhbmNlbCgxKQoKPT0gTkFNRQp0aW1ldy1jYW5jZWwgLSBjYW5jZWwgdGltZSB0cmFja2luZwoKPT0gU1lOT1BTSVMKW3ZlcnNlXQoqdGltZXcgY2FuY2VsKgoKPT0gREVTQ1JJUFRJT04KSWYgdGhlcmUgaXMgYW4gb3BlbiBpbnRlcnZhbCwgaXQgaXMgYWJhbmRvbmVkLgoKPT0gRVhBTVBMRVMKCipDYW5jZWwgd2l0aCBhY3RpdmUgdGltZSB0cmFja2luZyo6OgorCiAgICAkIHRpbWV3IHN0YXJ0CiAgICAuLi4KICAgICQgdGltZXcgY2FuY2VsCiAgICBDYW5jZWxlZCBhY3RpdmUgdGltZSB0cmFja2luZy4KClRoaXMgZGVsZXRlcyB0aGUgb3BlbiBpbnRlcnZhbC4KCipDYW5jZWwgd2l0aCBubyBhY3RpdmUgdGltZSB0cmFja2luZyo6OgorCiAgICAuLi4KICAgICQgdGltZXcgc3RvcAogICAgJCB0aW1ldyBjYW5jZWwKICAgIFRoZXJlIGlzIG5vIGFjdGl2ZSB0aW1lIHRyYWNraW5nLgoKQ2FuY2VsIGhhcyBubyBlZmZlY3QsIG9ubHkgYSB3YXJuaW5nIGlzIHByaW50ZWQuCgo9PSBTRUUgQUxTTwoqKnRpbWV3LWNvbnRpbnVlKiooMSksCioqdGltZXctc3RhcnQqKigxKSwKKip0aW1ldy1zdG9wKiooMSksCioqdGltZXctdHJhY2sqKigxKQo="
# ]

changed_filenames = ast.literal_eval(sys.argv[1])
encoded_file_contents = ast.literal_eval(sys.argv[2])


def update_files(changed_filenames, encoded_file_contents):
    pattern = re.compile(r'doc/man\d/(.*)')
    filenames = [pattern.sub(r'\1', name) for name in changed_filenames]

    for i in range(len(filenames)):
        with open(f'../content/reference/{filenames[i]}', "w") as f:
            f.write(b64decode(encoded_file_contents[i]).decode('utf-8'))


if __name__ == "__main__":
    update_files(changed_filenames, encoded_file_contents)
